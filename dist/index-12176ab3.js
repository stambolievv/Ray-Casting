/**
 * @name ray-casting
 * @description Visualization of Ray Casting and Line-Line Intersection
 *
 * @version 1.0.0
 * @author Deyan 'stambolievv' Stamboliev
 * @license Apache-2.0
 */
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const h of s.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&e(h)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();class o{constructor({x:t=0,y:i=0}={}){this._x=t,this._y=i}set x(t){this._x=t}get x(){return this._x}set y(t){this._y=t}get y(){return this._y}get width(){return this._x}get height(){return this._y}get magnitude(){return Math.sqrt(this._x**2+this._y**2)}get length(){return Math.sqrt(this._x**2+this._y**2)}get direction(){return Math.atan2(this._y,this._x)}get directionD(){return Math.atan2(this._y,this._x)*180/Math.PI}get angle(){return Math.atan2(this._y,this._x)}get angleD(){return Math.atan2(this._y,this._x)*180/Math.PI}get absoluteX(){return Math.abs(this._x)}get absoluteY(){return Math.abs(this._y)}set(t,i){return this._x=t,this._y=i!=null?i:t,this}add(t){return new o({x:this._x+t.x,y:this._y+t.y})}addSelf(t){return this._x+=t.x,this._y+=t.y,this}subtract(t){return new o({x:this._x-t.x,y:this._y-t.y})}subtractSelf(t){return this._x-=t.x,this._y-=t.y,this}multiply(t){return new o({x:this._x*t.x,y:this._y*t.y})}multiplySelf(t){return this._x*=t.x,this._y*=t.y,this}divide(t){return new o({x:this._x/t.x,y:this._y/t.y})}divideSelf(t){return this._x/=t.x,this._y/=t.y,this}addScalar(t,i){return new o({x:this._x+t,y:this._y+(i!=null?i:t)})}addScalarSelf(t,i){return this._x+=t,this._y+=i!=null?i:t,this}subtractScalar(t,i){return new o({x:this._x-t,y:this._y-(i!=null?i:t)})}subtractScalarSelf(t,i){return this._x-=t,this._y-=i!=null?i:t,this}multiplyScalar(t,i){return new o({x:this._x*t,y:this._y*(i!=null?i:t)})}multiplyScalarSelf(t,i){return this._x*=t,this._y*=i!=null?i:t,this}divideScalar(t,i){return new o({x:this._x/t,y:this._y/(i!=null?i:t)})}divideScalarSelf(t,i){return this._x/=t,this._y/=i!=null?i:t,this}dotProduct(t){return this._x*t.x+this._y*t.y}crossProduct(t){return this._x*t.y-this._y*t.x}distance(t){return Math.sqrt((this._x-t.x)**2+(this._y-t.y)**2)}lerp(t,i){return this._x+=(t._x-this._x)*i,this._y+=(t._y-this._y)*i,this}rotate(t,i){const e=Math.PI/180*i,n=Math.cos(e),s=Math.sin(e),h=n*(this._x-t.x)+s*(this._y-t.y)+t.x,y=n*(this._y-t.y)-s*(this._x-t.x)+t.y;return this._x=h,this._y=y,this}ceil(){return this._y=Math.ceil(this._y),this._x=Math.ceil(this._x),this}floor(){return this._y=Math.floor(this._y),this._x=Math.floor(this._x),this}round(){return this._y=Math.round(this._y),this._x=Math.round(this._x),this}min(t){return this._x>t.x&&(this._x=t.x),this._y>t.y&&(this._y=t.y),this}max(t){return this._x<t.x&&(this._x=t.x),this._y<t.y&&(this._y=t.y),this}equals(t){return this._x===t.x&&this._y===t.y}clear(){return this._x=0,this._y=0,this}invert(){return this._x*=-1,this._y*=-1,this}normalize(){return new o({x:this._x/Math.sqrt(this._x**2+this._y**2)||1,y:this._y/Math.sqrt(this._x**2+this._y**2)||1})}copy(t){return this._x=t.x,this._y=t.y,this}clone(){return new o({x:this._x,y:this._y})}toString(){return`x: ${this._x}, y: ${this.y}`}toArray(){return[this._x,this._y]}toObject(){return{x:this._x,y:this._y}}}function m(r,t){const i=new Array(r);for(let e=0;e<i.length;e++){const n=typeof t=="function"?t(e):t;i[e]=typeof n<"u"?n:e}return i}function P(r,t){return Math.random()*(t-r)+r}function c(r,t){return Math.floor(P(r,t+1))}function M(r,t,i){return(r-t[0])/(t[1]-t[0])*(i[1]-i[0])+i[0]}function w(){return`#${Math.floor(Math.random()*16777215).toString(16)}`}function S(r){return Array.isArray?Array.isArray(r):r instanceof Array}class p{constructor({position:t={x:0,y:0},length:i=300,angle:e=0,config:n={}}={}){this.startPoint=new o({x:t.x,y:t.y}),this.endPoint=new o({x:t.x,y:t.y+i}).rotate(this.startPoint,e),this.intersectionPoint=this.endPoint.clone(),this.length=this.startPoint.distance(this.endPoint),this.angle=e,this.config=n,this.color=this.config.color||w()}draw(t){t.beginPath(),t.moveTo(...this.startPoint.toArray()),t.lineTo(...this.intersectionPoint.toArray()),t.closePath(),t.lineWidth=this.config.lineWidth,t.strokeStyle=this.color,t.stroke()}update(t){const{x:i,y:e}=t;this.startPoint.set(i,e),this.endPoint.set(i,e+this.length).rotate(this.startPoint,this.angle)}intersection(t){const i=this.startPoint,e=this.endPoint,n=t.startPoint,s=t.endPoint,h=n.subtract(i).crossProduct(e.subtract(i)),y=e.subtract(i).crossProduct(s.subtract(n));if(h===0&&y===0)return i.equals(n)||e.equals(n)||i.equals(s)||e.equals(s)?{type:"colinear-overlapping"}:[...n.subtract(i).toArray(),...n.subtract(e).toArray(),...s.subtract(i).toArray(),...s.subtract(e).toArray()].every(b=>b<0)?{type:"colinear-joint"}:{type:"colinear-disjoint"};if(y===0)return{type:"parallel-non-intersecting"};const f=h/y,_=n.subtract(i).crossProduct(s.subtract(n))/y;return _>=0&&_<=1&&f>=0&&f<=1?{type:"intersection",point:new o(i.add(e.subtract(i).multiplyScalar(_)).toObject())}:{type:"no-intersection"}}}class A{constructor({position:t={x:0,y:0},amount:i=360,length:e=1e3,angle:n=[0,360],config:s={}}={}){this.config=s,this.lines=m(i,h=>{const y={position:t,length:e,angle:M(h,[0,i],n),config:{color:this.config.color,lineWidth:this.config.lineWidth}};return new p(y)})}draw(t){this.lines.forEach(i=>i.draw(t))}update(t){this.lines.forEach(i=>i.update(t))}intersection(t){const i=S(t)?t:[t];this.lines.forEach(e=>{const n={closest:null,record:1/0};i.forEach(s=>{const h=e.intersection(s);if(h.point){const y=e.startPoint.distance(h.point);y<n.record&&(n.record=y,n.closest=h.point)}n.closest?e.intersectionPoint=n.closest:e.intersectionPoint=e.endPoint.clone()})})}}const d={scene:{backgroundColor:"#111"},rays:{amount:150,length:1e3,angle:[0,360],color:"rgba(245, 245, 45, 0.4)",lineWidth:1},line:{lineWidth:3}},u=document.getElementById("canvas");u.width=window.innerWidth;u.height=window.innerHeight;const a=u.getContext("2d");a.imageSmoothingEnabled=!1;const x={x:0,y:0},l=new A({...d.rays,config:d.rays}),g=m(c(10,15),()=>{const r={position:{x:c(0,u.width),y:c(0,u.height)},length:c(100,500),angle:c(0,360),config:d.line,color:w()};return new p(r)});(function r(t){window.requestAnimationFrame(r),a.fillStyle=d.scene.backgroundColor,a.fillRect(0,0,u.width,u.height),l.draw(a),l.update(x),l.intersection(g),g.forEach(i=>i.draw(a))})();window.addEventListener("pointermove",r=>{const t=u.getBoundingClientRect();x.x=(r.clientX-t.left)/(t.right-t.left)*u.width,x.y=(r.clientY-t.top)/(t.bottom-t.top)*u.height});
